<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema ETI â€“ Seguimiento de Capacitaciones de Ã‰tica Social</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
  <div class="header-inner">
    <div class="header-brand">
      <div class="brand-icon">ETI</div>
      <div class="brand-text">
        <span class="brand-title">Sistema de Capacitaciones</span>
        <span class="brand-sub">Ã‰tica e Integridad Â· Relaciones Laborales</span>
      </div>
    </div>
    <div class="header-meta">
      <div class="season-badge" id="seasonBadge">â€“</div>
      <div class="current-date" id="currentDate">â€“</div>
    </div>
  </div>
</header>

<!-- NAVIGATION TABS -->
<nav class="tab-nav">
  <button class="tab-btn active" data-tab="dashboard">ğŸ“Š Dashboard</button>
  <button class="tab-btn" data-tab="registro">â• Registrar</button>
  <button class="tab-btn" data-tab="tabla">ğŸ“‹ Registros</button>
  <button class="tab-btn" data-tab="ranking">ğŸ† Ranking</button>
</nav>

<!-- ===================== TAB: DASHBOARD ===================== -->
<section class="tab-content active" id="tab-dashboard">
  <div class="dashboard-grid">

    <!-- KPI Cards -->
    <div class="kpi-row" id="kpiRow">
      <div class="kpi-card kpi-total">
        <div class="kpi-value" id="kpiTotal">0</div>
        <div class="kpi-label">Total Registros</div>
      </div>
      <div class="kpi-card kpi-cumplido">
        <div class="kpi-value" id="kpiCumplido">0</div>
        <div class="kpi-label">Cumplidos</div>
      </div>
      <div class="kpi-card kpi-proceso">
        <div class="kpi-value" id="kpiProceso">0</div>
        <div class="kpi-label">En Proceso</div>
      </div>
      <div class="kpi-card kpi-retraso">
        <div class="kpi-value" id="kpiRetraso">0</div>
        <div class="kpi-label">Con Retraso</div>
      </div>
      <div class="kpi-card kpi-pct">
        <div class="kpi-value" id="kpiPct">0%</div>
        <div class="kpi-label">% Cumplimiento</div>
      </div>
    </div>

    <!-- Alertas -->
    <div class="alerts-panel" id="alertsPanel">
      <h3 class="panel-title">âš ï¸ Alertas Activas</h3>
      <div id="alertsList"><p class="empty-msg">Sin alertas activas.</p></div>
    </div>

    <!-- Charts row -->
    <div class="charts-row">
      <div class="chart-card">
        <h3 class="chart-title">Estado General</h3>
        <canvas id="chartEstado"></canvas>
      </div>
      <div class="chart-card">
        <h3 class="chart-title">Cumplimiento por Supervisor</h3>
        <canvas id="chartSupervisor"></canvas>
      </div>
      <div class="chart-card">
        <h3 class="chart-title">Registros por Mes</h3>
        <canvas id="chartMes"></canvas>
      </div>
      <div class="chart-card">
        <h3 class="chart-title">Alta vs Baja Temporada</h3>
        <canvas id="chartTemporada"></canvas>
      </div>
    </div>

  </div>
</section>

<!-- ===================== TAB: REGISTRO ===================== -->
<section class="tab-content" id="tab-registro">
  <div class="form-wrapper">
    <h2 class="form-heading">Registrar Nueva CapacitaciÃ³n ETI</h2>
    <form id="etiForm" novalidate>

      <div class="form-grid">
        <div class="form-group">
          <label for="fSupervisor">Supervisor *</label>
          <input type="text" id="fSupervisor" placeholder="Nombre completo" required />
        </div>
        <div class="form-group">
          <label for="fSector">Sector / Ãrea *</label>
          <input type="text" id="fSector" placeholder="Ej: Cosecha Norte" required />
        </div>
        <div class="form-group">
          <label for="fTrabajadores">NÂ° Trabajadores *</label>
          <input type="number" id="fTrabajadores" placeholder="0" min="1" required />
        </div>
        <div class="form-group">
          <label for="fTema">Tema de CapacitaciÃ³n *</label>
          <input type="text" id="fTema" placeholder="Ej: Acoso laboral, Trabajo infantilâ€¦" required />
        </div>
        <div class="form-group">
          <label for="fFechaEjecucion">Fecha de EjecuciÃ³n *</label>
          <input type="date" id="fFechaEjecucion" required />
        </div>
        <div class="form-group">
          <label for="fFechaEnvio">Fecha de EnvÃ­o de Actas</label>
          <input type="date" id="fFechaEnvio" />
          <small>Dejar en blanco si aÃºn no se enviÃ³</small>
        </div>
        <div class="form-group full-width">
          <label for="fObservaciones">Observaciones</label>
          <textarea id="fObservaciones" rows="2" placeholder="Notas adicionalesâ€¦"></textarea>
        </div>
      </div>

      <!-- Preview automÃ¡tico -->
      <div class="preview-box" id="previewBox" style="display:none;">
        <h4>Vista previa del cÃ¡lculo</h4>
        <div class="preview-grid" id="previewGrid"></div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnPreview">ğŸ‘ Vista Previa</button>
        <button type="submit" class="btn btn-primary">ğŸ’¾ Guardar Registro</button>
      </div>
    </form>
  </div>
</section>

<!-- ===================== TAB: TABLA ===================== -->
<section class="tab-content" id="tab-tabla">
  <div class="table-wrapper">
    <div class="table-toolbar">
      <h2 class="form-heading">Registros de Capacitaciones</h2>
      <div class="toolbar-actions">
        <input type="text" id="searchInput" placeholder="ğŸ” Buscarâ€¦" class="search-input" />
        <button class="btn btn-success" id="btnExportExcel">ğŸ“¥ Exportar Excel</button>
        <button class="btn btn-danger" id="btnClearAll">ğŸ—‘ Limpiar Todo</button>
      </div>
    </div>
    <div class="table-scroll">
      <table id="mainTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Supervisor</th>
            <th>Sector</th>
            <th>Trabajadores</th>
            <th>Tema</th>
            <th>F. EjecuciÃ³n</th>
            <th>F. LÃ­mite</th>
            <th>F. EnvÃ­o</th>
            <th>Temporada</th>
            <th>% Avance</th>
            <th>% Retraso</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="mainTableBody"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- ===================== TAB: RANKING ===================== -->
<section class="tab-content" id="tab-ranking">
  <div class="ranking-wrapper">
    <h2 class="form-heading">ğŸ† Ranking de Supervisores</h2>
    <p class="ranking-desc">Basado en porcentaje de cumplimiento acumulado. Se recalcula automÃ¡ticamente con la fecha actual.</p>
    <div id="rankingContainer"></div>
  </div>
</section>

<!-- MODAL EDITAR -->
<div class="modal-overlay" id="modalOverlay" style="display:none;">
  <div class="modal-box">
    <div class="modal-header">
      <h3>Editar Registro</h3>
      <button class="modal-close" id="modalClose">âœ•</button>
    </div>
    <form id="editForm">
      <input type="hidden" id="editId" />
      <div class="form-grid">
        <div class="form-group">
          <label>Supervisor</label>
          <input type="text" id="eSupervisor" required />
        </div>
        <div class="form-group">
          <label>Sector</label>
          <input type="text" id="eSector" required />
        </div>
        <div class="form-group">
          <label>NÂ° Trabajadores</label>
          <input type="number" id="eTrabajadores" min="1" required />
        </div>
        <div class="form-group">
          <label>Tema</label>
          <input type="text" id="eTema" required />
        </div>
        <div class="form-group">
          <label>F. EjecuciÃ³n</label>
          <input type="date" id="eFechaEjecucion" required />
        </div>
        <div class="form-group">
          <label>F. EnvÃ­o</label>
          <input type="date" id="eFechaEnvio" />
        </div>
        <div class="form-group full-width">
          <label>Observaciones</label>
          <textarea id="eObservaciones" rows="2"></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnCancelEdit">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </div>
    </form>
  </div>
</div>

<!-- FOOTER -->
<footer class="site-footer">
  <div class="footer-inner">
    <span>Creado por <strong>Joel A. Timoteo Gonza</strong> â€“ Equipo de Relaciones Laborales</span>
    <span class="footer-ver">Sistema ETI v1.0 Â· 2025</span>
  </div>
</footer>

<script src="script.js"></script>
</body>
</html>
