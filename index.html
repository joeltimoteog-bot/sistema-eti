<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema ETI ‚Äì Seguimiento de Capacitaciones de √âtica Social</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>

<header class="site-header">
  <div class="header-inner">
    <div class="header-brand">
      <div class="brand-icon">ETI</div>
      <div class="brand-text">
        <span class="brand-title">Sistema de Capacitaciones</span>
        <span class="brand-sub">√âtica e Integridad ¬∑ Relaciones Laborales</span>
      </div>
    </div>
    <div class="header-meta">
      <div class="season-badge" id="seasonBadge">‚Äì</div>
      <div class="current-date" id="currentDate">‚Äì</div>
    </div>
  </div>
</header>

<nav class="tab-nav">
  <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
  <button class="tab-btn" data-tab="registro">‚ûï Registrar</button>
  <button class="tab-btn" data-tab="tabla">üìã Registros</button>
  <button class="tab-btn" data-tab="ranking">üèÜ Ranking</button>
</nav>

<!-- DASHBOARD -->
<section class="tab-content active" id="tab-dashboard">
  <div class="dashboard-grid">
    <div class="kpi-row">
      <div class="kpi-card kpi-total"><div class="kpi-value" id="kpiTotal">0</div><div class="kpi-label">Total Registros</div></div>
      <div class="kpi-card kpi-cumplido"><div class="kpi-value" id="kpiCumplido">0</div><div class="kpi-label">Cumplidos</div></div>
      <div class="kpi-card kpi-proceso"><div class="kpi-value" id="kpiProceso">0</div><div class="kpi-label">En Proceso</div></div>
      <div class="kpi-card kpi-retraso"><div class="kpi-value" id="kpiRetraso">0</div><div class="kpi-label">Con Retraso</div></div>
      <div class="kpi-card kpi-pct"><div class="kpi-value" id="kpiPct">0%</div><div class="kpi-label">% Cumplimiento</div></div>
    </div>
    <div class="alerts-panel">
      <h3 class="panel-title">‚ö†Ô∏è Alertas Activas</h3>
      <div id="alertsList"><p class="empty-msg">Sin alertas activas.</p></div>
    </div>
    <div class="charts-row">
      <div class="chart-card"><h3 class="chart-title">Estado General</h3><canvas id="chartEstado"></canvas></div>
      <div class="chart-card"><h3 class="chart-title">Cumplimiento por Supervisor</h3><canvas id="chartSupervisor"></canvas></div>
      <div class="chart-card"><h3 class="chart-title">Registros por Mes</h3><canvas id="chartMes"></canvas></div>
      <div class="chart-card"><h3 class="chart-title">Alta vs Baja Temporada</h3><canvas id="chartTemporada"></canvas></div>
    </div>
  </div>
</section>

<!-- REGISTRO -->
<section class="tab-content" id="tab-registro">
  <div class="form-wrapper">
    <h2 class="form-heading">Registrar Nueva Capacitaci√≥n ETI</h2>
    <form id="etiForm" novalidate>

      <div class="section-block">
        <h3 class="section-subtitle">üë§ Datos del Supervisor</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="fSupervisor">Supervisor de Gesti√≥n Humana *</label>
            <select id="fSupervisor" required>
              <option value="">‚Äî Seleccionar supervisor ‚Äî</option>
              <option value="POOL TAMAYO RODRIGUEZ|SECTOR EL PAPAYO">POOL TAMAYO RODRIGUEZ ‚Äì El Papayo</option>
              <option value="POOL TAMAYO RODRIGUEZ|SECTOR LIMONES">POOL TAMAYO RODRIGUEZ ‚Äì Limones</option>
              <option value="ALEX TINEO RAMOS|SECTOR OLIVARES BAJO">ALEX TINEO RAMOS</option>
              <option value="FLOR PULACHE VIERA|SECTOR LOS OLIVARES">FLOR PULACHE VIERA</option>
              <option value="ALEX ZAPATA JUAREZ|SECTOR APROA">ALEX ZAPATA JUAREZ</option>
              <option value="YHANELLY LUZON VENEGA|SECTOR SANTA ROSA">YHANELLY LUZON VENEGA</option>
              <option value="ALEXANDER MARTINEZ JUAREZ|SECTOR PUNTA ARENAS">ALEXANDER MARTINEZ JUAREZ</option>
              <option value="SERGIO VIERA GIRON|SECTOR ALGARROBOS">SERGIO VIERA GIRON</option>
              <option value="ELBERTH CASTRO BAYONA|SECTOR SAN VICENTE">ELBERTH CASTRO BAYONA</option>
            </select>
          </div>
          <div class="form-group">
            <label for="fSector">Sector (auto-completado)</label>
            <input type="text" id="fSector" readonly class="input-readonly" placeholder="Se completa al elegir supervisor" />
          </div>
        </div>
      </div>

      <div class="section-block">
        <h3 class="section-subtitle">üë• Trabajadores Capacitados</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="fVarones">N¬∞ Varones Capacitados *</label>
            <input type="number" id="fVarones" placeholder="0" min="0" required />
          </div>
          <div class="form-group">
            <label for="fMujeres">N¬∞ Mujeres Capacitadas *</label>
            <input type="number" id="fMujeres" placeholder="0" min="0" required />
          </div>
          <div class="form-group">
            <label>Total Trabajadores (autom√°tico)</label>
            <input type="text" id="fTotal" readonly class="input-readonly input-highlight" placeholder="0" />
          </div>
        </div>
      </div>

      <div class="section-block">
        <h3 class="section-subtitle">üìö Datos de la Capacitaci√≥n</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="fTema">Tema de Capacitaci√≥n *</label>
            <select id="fTema" required>
              <option value="">‚Äî Seleccionar tema ‚Äî</option>
              <option value="CAPACITACIONES ETI">CAPACITACIONES ETI</option>
              <option value="EVALUACIONES DE CHECKLIST">EVALUACIONES DE CHECKLIST</option>
              <option value="REFORZAMIENTO">REFORZAMIENTO</option>
            </select>
          </div>
          <div class="form-group">
            <label for="fFechaEjecucion">Fecha de Ejecuci√≥n *</label>
            <input type="date" id="fFechaEjecucion" required />
          </div>
          <div class="form-group">
            <label for="fFechaEnvio">Fecha de Env√≠o de Actas</label>
            <input type="date" id="fFechaEnvio" />
            <small>Dejar en blanco si a√∫n no se envi√≥</small>
          </div>
        </div>
      </div>

      <!-- RUTAS -->
      <div class="section-block">
        <h3 class="section-subtitle">üìç Rutas Capacitadas</h3>

        <div class="form-group">
          <label>¬øCu√°ntas rutas capacit√≥ el supervisor?</label>
          <div class="rutas-opciones">
            <label class="radio-option">
              <input type="radio" name="tipoRutas" value="numero" id="rNumero" />
              <span>Indicar cantidad de rutas (1 ‚Äì 25)</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="tipoRutas" value="varias" id="rVarias" />
              <span>Rutas Varias (sin detalle)</span>
            </label>
          </div>
        </div>

        <div id="rutasNumeroCont" style="display:none; margin-top:14px;">
          <div class="form-group" style="max-width:220px;">
            <label for="fCantRutas">Cantidad de rutas a registrar</label>
            <input type="number" id="fCantRutas" min="1" max="25" placeholder="Ej: 5" />
          </div>
          <div id="rutasItemsCont" style="margin-top:14px;"></div>
        </div>

        <div id="rutasVariasCont" style="display:none; margin-top:12px;">
          <div class="rutas-varias-badge">‚úÖ Rutas Varias ‚Äì No se requiere ingresar detalle de rutas</div>
        </div>
      </div>

      <div class="section-block">
        <div class="form-group">
          <label for="fObservaciones">Observaciones</label>
          <textarea id="fObservaciones" rows="2" placeholder="Notas adicionales‚Ä¶"></textarea>
        </div>
      </div>

      <div class="preview-box" id="previewBox" style="display:none;">
        <h4>Vista previa del c√°lculo</h4>
        <div class="preview-grid" id="previewGrid"></div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnPreview">üëÅ Vista Previa</button>
        <button type="submit" class="btn btn-primary">üíæ Guardar Registro</button>
      </div>
    </form>
  </div>
</section>

<!-- TABLA -->
<section class="tab-content" id="tab-tabla">
  <div class="table-wrapper">
    <div class="table-toolbar">
      <h2 class="form-heading">Registros de Capacitaciones</h2>
      <div class="toolbar-actions">
        <input type="text" id="searchInput" placeholder="üîç Buscar‚Ä¶" class="search-input" />
        <button class="btn btn-success" id="btnExportExcel">üì• Exportar Excel</button>
        <button class="btn btn-danger" id="btnClearAll">üóë Limpiar Todo</button>
      </div>
    </div>
    <div class="table-scroll">
      <table id="mainTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Supervisor</th>
            <th>Sector</th>
            <th>‚ôÇ Varones</th>
            <th>‚ôÄ Mujeres</th>
            <th>Total</th>
            <th>Tema</th>
            <th>Rutas</th>
            <th>F. Ejecuci√≥n</th>
            <th>F. L√≠mite</th>
            <th>F. Env√≠o</th>
            <th>Temporada</th>
            <th>% Avance</th>
            <th>% Retraso</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="mainTableBody"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- RANKING -->
<section class="tab-content" id="tab-ranking">
  <div class="ranking-wrapper">
    <h2 class="form-heading">üèÜ Ranking de Supervisores</h2>
    <p class="ranking-desc">Basado en porcentaje de cumplimiento acumulado. Se recalcula autom√°ticamente con la fecha actual.</p>
    <div id="rankingContainer"></div>
  </div>
</section>

<!-- MODAL EDITAR -->
<div class="modal-overlay" id="modalOverlay" style="display:none;">
  <div class="modal-box">
    <div class="modal-header">
      <h3>Editar Registro</h3>
      <button class="modal-close" id="modalClose">‚úï</button>
    </div>
    <form id="editForm">
      <input type="hidden" id="editId" />
      <div class="form-grid">
        <div class="form-group">
          <label>Supervisor</label>
          <select id="eSupervisor">
            <option value="">‚Äî Seleccionar ‚Äî</option>
            <option value="POOL TAMAYO RODRIGUEZ|SECTOR EL PAPAYO">POOL TAMAYO RODRIGUEZ ‚Äì El Papayo</option>
            <option value="POOL TAMAYO RODRIGUEZ|SECTOR LIMONES">POOL TAMAYO RODRIGUEZ ‚Äì Limones</option>
            <option value="ALEX TINEO RAMOS|SECTOR OLIVARES BAJO">ALEX TINEO RAMOS</option>
            <option value="FLOR PULACHE VIERA|SECTOR LOS OLIVARES">FLOR PULACHE VIERA</option>
            <option value="ALEX ZAPATA JUAREZ|SECTOR APROA">ALEX ZAPATA JUAREZ</option>
            <option value="YHANELLY LUZON VENEGA|SECTOR SANTA ROSA">YHANELLY LUZON VENEGA</option>
            <option value="ALEXANDER MARTINEZ JUAREZ|SECTOR PUNTA ARENAS">ALEXANDER MARTINEZ JUAREZ</option>
            <option value="SERGIO VIERA GIRON|SECTOR ALGARROBOS">SERGIO VIERA GIRON</option>
            <option value="ELBERTH CASTRO BAYONA|SECTOR SAN VICENTE">ELBERTH CASTRO BAYONA</option>
          </select>
        </div>
        <div class="form-group">
          <label>Sector</label>
          <input type="text" id="eSector" readonly class="input-readonly" />
        </div>
        <div class="form-group">
          <label>Varones Capacitados</label>
          <input type="number" id="eVarones" min="0" />
        </div>
        <div class="form-group">
          <label>Mujeres Capacitadas</label>
          <input type="number" id="eMujeres" min="0" />
        </div>
        <div class="form-group">
          <label>Tema</label>
          <select id="eTema" required>
            <option value="">‚Äî Seleccionar ‚Äî</option>
            <option value="CAPACITACIONES ETI">CAPACITACIONES ETI</option>
            <option value="EVALUACIONES DE CHECKLIST">EVALUACIONES DE CHECKLIST</option>
            <option value="REFORZAMIENTO">REFORZAMIENTO</option>
          </select>
        </div>
        <div class="form-group">
          <label>F. Ejecuci√≥n</label>
          <input type="date" id="eFechaEjecucion" required />
        </div>
        <div class="form-group">
          <label>F. Env√≠o</label>
          <input type="date" id="eFechaEnvio" />
        </div>
        <div class="form-group full-width">
          <label>Observaciones</label>
          <textarea id="eObservaciones" rows="2"></textarea>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnCancelEdit">Cancelar</button>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </div>
    </form>
  </div>
</div>

<footer class="site-footer">
  <div class="footer-inner">
    <span>Creado por <strong>Joel A. Timoteo Gonza</strong> ‚Äì Equipo de Relaciones Laborales</span>
    <span class="footer-ver">Sistema ETI v2.0 ¬∑ 2025</span>
  </div>
</footer>

<script src="script.js"></script>
</body>
</html>
